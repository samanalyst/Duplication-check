<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Osterei-Angebote 2024</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Netcup Osterei-Angebote 2024</h1>
    <div id="eggContainer" class="eggGrid"></div>

    <script>
        // Funktion zum Laden und Anzeigen der Daten
        function loadEggs() {
            const eggContainer = document.getElementById('eggContainer');

            // Verzeichnis mit den JSON-Dateien
            
            const directory = '/netcup_egg_tracker/eggs_2024/';

            // Basis-URL für die Bilder
            const imageURLBase = 'https://www.netcup.de/static/assets/images/eastern/';

            // AJAX-Anfrage zum Laden der Dateiliste
            fetch(directory)
                .then(response => response.text())
                .then(text => {
                    // Parse HTML-Text zu DOM-Objekt
                    const parser = new DOMParser();
                    const htmlDocument = parser.parseFromString(text, 'text/html');

                    // Liste der JSON-Dateien im Verzeichnis
                    const fileLinks = Array.from(htmlDocument.querySelectorAll('a')).map(a => a.href);

                    // Für jede JSON-Datei
                    Promise.all(fileLinks.map(filePath => fetch(filePath).then(response => response.text())))
                        .then(dataArray => {
                            // Parse JSON-Daten und Sortieren
                            const sortedData = dataArray.map(jsonString => {
                                try {
                                    return JSON.parse(jsonString);
                                } catch (error) {
                                    console.error('Fehler beim Parsen der JSON-Daten:', error);
                                    console.log('Ungültige JSON-Daten:', jsonString);
                                    return null;
                                }
                            }).filter(data => data !== null) // Entfernen von null-Werten
                            .sort((a, b) => (a.title > b.title) ? 1 : -1); // Sortieren nach Titel

                            // Für jede sortierte JSON-Datei
                            sortedData.forEach(data => {
                                // Daten aus der JSON-Datei extrahieren
                                const { id, title, image, price, original_url } = data;

                                // Bildpfad zusammensetzen
                                const imagePath = imageURLBase + image;

                                // Eintrag für das Osterei erstellen
                                const eggElement = document.createElement('div');
                                eggElement.className = 'eggCard';

                                // Link um die gesamte Karte herum platzieren
                                eggElement.innerHTML = `
                                    <a href="${original_url}" target="_blank" class="eggLink">
                                        <div class="eggCardContent">
                                            <img src="${imagePath}" alt="Ei-Bild" class="eggImage">
                                            <h2>${title}</h2>
                                            <p>Preis: ${price}</p>
                                            <p><em>Klicken Sie, um das Angebot anzuzeigen</em></p>
                                        </div>
                                    </a>
                                `;
                                eggContainer.appendChild(eggElement);
                            });
                        })
                        .catch(error => console.error('Fehler beim Laden oder Sortieren der Daten:', error));
                })
                .catch(error => console.error('Fehler beim Laden der Dateiliste:', error));
        }

        // Webseite initialisieren
        window.onload = loadEggs;
    </script>
</body>
</html>
